<!DOCTYPE html>
<html>
    <head>
    <!-- Title -->
    
    <title>
        webview接入HttpDNS实践 | FelixZhang&#39;s Blog
    </title>
    
    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">
    
    <!-- Meta & INfo -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="Felix">
    <meta name="description" content="null">
    <meta name="keywords" content="null">
    
    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">
    
    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="FelixZhang&#39;s Blog">
    
    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://felixzhang00.github.io">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="webview接入HttpDNS实践 | FelixZhang&#39;s Blog">
    <meta property="og:description" content="null">
    
     <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">
        
        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->
    
    <!-- Import CSS -->
    <link rel="stylesheet" href="/css/material.min.css">
    <link rel="stylesheet" href="/css/style.min.css">
    <!-- Config CSS -->


<!-- Other Styles -->
<style>
	body, html{
		font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
	}
	
    a{
        color: #00838F
    }
    
    .mdl-card__media,
    #search-label,
    #search-form-label:after,
    #scheme-Paradox .hot_tags-count,
    #scheme-Paradox .sidebar_archives-count,
    #scheme-Paradox .sidebar-colored .sidebar-header,
    #scheme-Paradox .sidebar-colored .sidebar-badge{
        background-color: #0097A7 !important
    }
    
	/* Sidebar User Drop Down Menu Text Color */
	#scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
    #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus{
        color: #0097A7 !important
    }
    
    #post_entry-right-info,
    .sidebar-colored .sidebar-nav li:hover > a,
    .sidebar-colored .sidebar-nav li:hover > a i,
    .sidebar-colored .sidebar-nav li > a:hover,
    .sidebar-colored .sidebar-nav li > a:hover i,
    .sidebar-colored .sidebar-nav li > a:focus i,
    .sidebar-colored .sidebar-nav > .open > a,
    .sidebar-colored .sidebar-nav > .open > a:hover,
    .sidebar-colored .sidebar-nav > .open > a:focus,
    #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a{
        color: #0097A7 !important
    }
    
    .toTop{
        background: #757575 !important
    }
		
	.material-layout .material-post>.material-nav,
	.material-layout .material-index>.material-nav,
	.material-nav a{
		color: #757575;
	}
		
	#scheme-Paradox .MD-burger-layer {
		background-color: #757575;
	}

	#scheme-Paradox #post-toc-trigger-btn{
		color: #757575;
	}
	
	.post-toc a:hover{
		color: #00838F;
		text-decoration: underline;
	}
</style>


<!-- Theme Background Related-->

    <style>
        body{
            background-color: #F5F5F5
        }
		
		/* blog_info bottom background */
        #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
            background-color: #fff;
        }
    </style>




<!-- Fade Effect -->

    <style>
        .fade {
            transition: all 800ms linear;
            -webkit-transform: translate3d(0,0,0);
            -moz-transform: translate3d(0,0,0);
            -ms-transform: translate3d(0,0,0);
            -o-transform: translate3d(0,0,0);
            transform: translate3d(0,0,0);
            opacity: 1;
        }

        .fade.out{
            opacity: 0;
        }
    </style>

	<script src="/js/jquery.min.js"></script>
	
	<link rel="stylesheet" href="/css/highlight/solarized-dark.css">
	
	<!-- UC Browser Compatible-->
	<script>
		var agent = navigator.userAgent.toLowerCase();
		if(agent.indexOf('ucbrowser')>0) {
			document.write('<link rel="stylesheet" href="/css/uc.css">');
		   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
		}
	</script>
    
    <!-- Custom Head -->
    
</head>
	
	

    <body id="scheme-Paradox">

		
        <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
				
			
			
            <!-- Main Container -->
            <main class="material-layout__content" id="main">
				
                <!-- Top Anchor -->
                <div id="top"></div>
				
				
                <!-- Hamburger Button -->
                <button class="MD-burger-icon sidebar-toggle">
                    <span class="MD-burger-layer"></span>
                </button>
				
				
                <!-- Post TOC -->

    
	<!-- Back Button -->
<!--
	<div class="material-back" id="backhome-div" tabindex="0">
		<a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" href="#" onclick="window.history.back();return false;" target="_self" role="button" data-upgraded=",MaterialButton,MaterialRipple">
			<i class="material-icons" role="presentation">arrow_back</i>
			<span class="mdl-button__ripple-container">
				<span class="mdl-ripple"></span>
			</span>
		</a>
	</div>			
-->
	<!-- Left aligned menu below button -->
	<button id="post-toc-trigger-btn"
			class="mdl-button mdl-js-button mdl-button--icon">
	  <i class="material-icons">format_list_numbered</i>
	</button>

	<ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect"
		for="post-toc-trigger-btn">
			
			<ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#HttpDNS简介"><span class="post-toc-number">1.</span> <span class="post-toc-text">HttpDNS简介</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#移动端的实现原理"><span class="post-toc-number">2.</span> <span class="post-toc-text">移动端的实现原理</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1、okhttp"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">1、okhttp</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2、native-hook的方法"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">2、native hook的方法</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#android-nativehook原理"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">android nativehook原理</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3、webview"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">3、webview</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#机型问题"><span class="post-toc-number">3.</span> <span class="post-toc-text">机型问题</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#参考"><span class="post-toc-number">4.</span> <span class="post-toc-text">参考</span></a></li></ol>
		
<!--			<li class="mdl-menu__item">Some Action</li>-->
	</ul>



<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">
		
        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
	<!-- Paradox Post Header -->
	
		
			<!-- Random Thumbnail -->
			<div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
				<script>
    
    var randomNum;
    randomNum = Math.floor(Math.random() * 5 + 1);
    
    $(".post_thumbnail-random").css('background-image', 'url(' + '/img/random/' + randomNum + '.png' + ')');
    
</script>

		
	
        <p class="article-headline-p">
            webview接入HttpDNS实践
        </p>
    </div>

	

				
				
					<!-- Paradox Post Info -->
					<div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">
    
    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.jpg" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>Felix</strong>
        <span>10月 19, 2017</span>
    </div>
    
    <div class="section-spacer"></div>
	
    <!-- Favorite -->
<!--
    <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
        <i class="material-icons" role="presentation">favorite</i>
        <span class="visuallyhidden">favorites</span>
    </button>
-->
    
    <!-- Tags (bookmark) -->
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/android/">android</a>
    </ul>
    
    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">

    

    

    <!-- Share Twitter -->
    <a class="post_share-link" href="https://twitter.com/intent/tweet?text=webview接入HttpDNS实践&url=http://felixzhang00.github.io//2017/10/19/webview接入HttpDNS实践/index.html&via=Felix" target="_blank">
        <li class="mdl-menu__item">
            分享到 Twitter
        </li>
    </a>

    <!-- Share Google+ -->
    <a class="post_share-link" href="https://plus.google.com/share?url=http://felixzhang00.github.io//2017/10/19/webview接入HttpDNS实践/index.html" target="_blank">
        <li class="mdl-menu__item">
            分享到 Google+
        </li>
    </a>

    <!-- Share Weibo -->
    <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=webview接入HttpDNS实践&url=http://felixzhang00.github.io//2017/10/19/webview接入HttpDNS实践/index.html&pic=&searchPic=false&style=simple" target="_blank">
        <li class="mdl-menu__item">
            分享到微博
        </li>
    </a>

    <!-- Share LinkedIn -->
    <a class="post_share-link" href="https://www.linkedin.com/shareArticle?mini=true&url=http://felixzhang00.github.io//2017/10/19/webview接入HttpDNS实践/index.html&title=webview接入HttpDNS实践" target="_blank">
        <li class="mdl-menu__item">
            分享到 LinkedIn
        </li>
    </a>
</ul>

</div>
				

                <!-- Post Content -->
                <div id="post-content" class="markdown-Github mdl-color-text--grey-700 mdl-card__supporting-text fade out">
	
		<p>本文是对去年做的webview接入HttpDNS工作的一个总结，拖的时间有点久了。主要分享了GOT Hook webview中域名解析函数的方法。</p>
<h2 id="HttpDNS简介"><a href="#HttpDNS简介" class="headerlink" title="HttpDNS简介"></a>HttpDNS简介</h2><p>首先简单介绍下移动App接入HttpDNS后有什么好处，这里直接引用腾讯云文档中的<a href="https://www.qcloud.com/document/product/379/3520" target="_blank" rel="external">说明</a>:</p>
<blockquote>
<p>HttpDNS是通过将移动APP及桌面应用的默认域名解析方式，替换为通过Http协议进行域名解析，以规避由运营商Local DNS服务异常所导致的用户网络接入异常。减少用户跨网访问，降低用户解析域名时延。</p>
</blockquote>
<p>更详细的内容可以参考这篇文章：<a href="https://mp.weixin.qq.com/s?__biz=MzA3ODgyNzcwMw==&amp;mid=201837080&amp;idx=1&amp;sn=b2a152b84df1c7dbd294ea66037cf262&amp;scene=2&amp;from=timeline&amp;isappinstalled=0&amp;utm_source=tuicool" target="_blank" rel="external">【鹅厂网事】全局精确流量调度新思路-HttpDNS服务详解</a></p>
<h2 id="移动端的实现原理"><a href="#移动端的实现原理" class="headerlink" title="移动端的实现原理"></a>移动端的实现原理</h2><p>域名的解析工作将在HttpDNS服务器上完成，客户端只要把待解析的域名作为参数发起一个HTTP请求，HttpDNS服务器就会把解析结果下发给客户端了。<br>在客户端，默认的域名解析是系统的<code>getaddrinfo()</code>库函数实现的，默认的域名解析请求会走到LocalDNS。<br>所以域名解析的工作必须要交给app应用层来实现。下面介绍几种实现方案。</p>
<h3 id="1、okhttp"><a href="#1、okhttp" class="headerlink" title="1、okhttp"></a>1、okhttp</h3><p>okhttp的实现是建立在socket之上的，并且实现了HTTP协议。对于客户端发起的http请求，okhttp首先会跟远端服务器建立socket连接，在此之前okhttp会根据http请求中url的domain做域名解析，默认的实现是java网络库提供的<code>InetAddress.getAllByName</code>。</p>
<p>如果项目中用的网络库是okhttp，所有的网络请求都是通过它完成的话就可以使用okhttp提供的DNS解析接口，实现自己的DNS resolver，代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpDns</span> <span class="keyword">implements</span> <span class="title">Dns</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> List&lt;InetAddress&gt; <span class="title">lookup</span><span class="params">(String hostname)</span> <span class="keyword">throws</span> UnknownHostException </span>&#123;</div><div class="line">	    <span class="comment">//DNSHelper完成DNS解析的具体工作，向HttpDNS服务器请求服务。</span></div><div class="line">        String ip = DNSHelper.getIpByHost(hostname);</div><div class="line">        List&lt;InetAddress&gt; inetAddresses = Arrays.asList(InetAddress.getAllByName(ip));</div><div class="line">        <span class="keyword">return</span> inetAddresses;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="2、native-hook的方法"><a href="#2、native-hook的方法" class="headerlink" title="2、native hook的方法"></a>2、native hook的方法</h3><p>通过Hook libc的<code>getaddrinfo</code>库函数，将函数指针指向app应用层实现的DNS解析函数地址。<br>要深入了解linux native hook的技术的话，需要了解ELF文件格式和动态链接的相关知识，可参考<a href="http://blog.csdn.net/u012455213/article/details/53862637" target="_blank" rel="external">ELF文件及android hook原理</a>。</p>
<p><code>getaddrinfo</code>是在libc.so中的定义的，其它库如<code>libandroid_runtime.so</code>、<code>libjavacore.so</code>要使用这个函数的话，只能通过动态导入符号的形式，好在java网络库底层是就是通过这个方式实现的。</p>
<h3 id="android-nativehook原理"><a href="#android-nativehook原理" class="headerlink" title="android nativehook原理"></a>android nativehook原理</h3><p>下面代码是arm架构的一种实现方案，具体实现参考Andrey Petrov的<a href="http://shadowwhowalks.blogspot.com/2013/01/android-hacking-hooking-system.html" target="_blank" rel="external">blog</a>. </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"linker.h"</span>  <span class="comment">// get it from bionic</span></span></div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">unsigned</span> <span class="title">elfhash</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *_name)</span></span>; <span class="comment">//hash函数</span></div><div class="line"><span class="comment">//查找散列表。经典的链接法解决散列冲突</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">static</span> Elf32_Sym *<span class="title">soinfo_elf_lookup</span><span class="params">(soinfo *si, <span class="keyword">unsigned</span> hash, <span class="keyword">const</span> <span class="keyword">char</span> *name)</span>  </span></div><div class="line"> &#123;  </div><div class="line">   Elf32_Sym *s;  </div><div class="line">   Elf32_Sym *symtab = si-&gt;symtab;  </div><div class="line">   <span class="keyword">const</span> <span class="keyword">char</span> *strtab = si-&gt;strtab;  </div><div class="line">   <span class="keyword">unsigned</span> n;  </div><div class="line">   n = hash % si-&gt;nbucket;  </div><div class="line">   <span class="keyword">for</span>(n = si-&gt;bucket[hash % si-&gt;nbucket]; n != <span class="number">0</span>; n = si-&gt;chain[n])&#123;  </div><div class="line">     s = symtab + n;  </div><div class="line">     <span class="keyword">if</span>(<span class="built_in">strcmp</span>(strtab + s-&gt;st_name, name)) <span class="keyword">continue</span>;  </div><div class="line">       <span class="keyword">return</span> s;  </div><div class="line">     &#125;  </div><div class="line">   <span class="keyword">return</span> <span class="literal">NULL</span>;  </div><div class="line"> &#125;  </div><div class="line"></div><div class="line"></div><div class="line"> <span class="comment">//soname:动态库名称;</span></div><div class="line"> <span class="comment">//symbol:待hook的函数名;</span></div><div class="line"> <span class="comment">//newval:新函数地址</span></div><div class="line"> <span class="function"><span class="keyword">int</span> <span class="title">hook_call</span><span class="params">(<span class="keyword">char</span> *soname, <span class="keyword">char</span> *symbol, <span class="keyword">unsigned</span> newval)</span> </span>&#123;  </div><div class="line">  soinfo *si = <span class="literal">NULL</span>;  </div><div class="line">  Elf32_Rel *rel = <span class="literal">NULL</span>;  </div><div class="line">  Elf32_Sym *s = <span class="literal">NULL</span>;   </div><div class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> sym_offset = <span class="number">0</span>;  </div><div class="line">  <span class="comment">//打开动态库，得到soinfo对象</span></div><div class="line">  si = (soinfo*) dlopen(soname, <span class="number">0</span>);  </div><div class="line"> <span class="comment">//通过查找散列表找到symbol对应符号表的索引</span></div><div class="line">  s = soinfo_elf_lookup(si, elfhash(symbol), symbol);  </div><div class="line">  sym_offset = s - si-&gt;symtab;  </div><div class="line">  </div><div class="line">  rel = si-&gt;plt_rel;<span class="comment">//指向plt表的起始位置  </span></div><div class="line">  <span class="comment">//遍历plt表</span></div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; si-&gt;plt_rel_count; i++, rel++) &#123;  </div><div class="line">   <span class="keyword">unsigned</span> type = ELF32_R_TYPE(rel-&gt;r_info);  </div><div class="line">   <span class="keyword">unsigned</span> sym = ELF32_R_SYM(rel-&gt;r_info);  </div><div class="line">   <span class="comment">//加上动态库的基址，定位到该符号重定向元素的内存</span></div><div class="line">   <span class="keyword">unsigned</span> reloc = (<span class="keyword">unsigned</span>)(rel-&gt;r_offset + si-&gt;base);  </div><div class="line">   <span class="keyword">uint32_t</span> page_size = <span class="number">0</span>;</div><div class="line">   <span class="keyword">uint32_t</span> entry_page_start = <span class="number">0</span>;</div><div class="line">   <span class="keyword">unsigned</span> oldval = <span class="number">0</span>;  </div><div class="line">   <span class="keyword">if</span> (sym_offset == sym) &#123;  <span class="comment">//是否是待hook的符号位置</span></div><div class="line">    <span class="keyword">switch</span>(type) &#123;  </div><div class="line">      <span class="keyword">case</span> R_ARM_JUMP_SLOT:</div><div class="line">	     <span class="comment">//修改内存页的属性为可读写  </span></div><div class="line">         page_size = getpagesize();</div><div class="line">         entry_page_start = reloc&amp; (~(page_size - <span class="number">1</span>));</div><div class="line">         <span class="keyword">int</span> ret = mprotect((<span class="keyword">uint32_t</span> *)entry_page_start, page_size, PROT_READ | PROT_WRITE); </div><div class="line">         </div><div class="line">         oldval = *(<span class="keyword">unsigned</span>*) reloc;  </div><div class="line">         *((<span class="keyword">unsigned</span>*)reloc) = newval;  <span class="comment">//成功替换这块内存的值为新函数的地址值 </span></div><div class="line">         <span class="keyword">return</span> <span class="number">1</span>;  </div><div class="line">      <span class="keyword">default</span>:  </div><div class="line">         <span class="keyword">return</span> <span class="number">0</span>;  </div><div class="line">    &#125;  </div><div class="line">   &#125;  </div><div class="line">  &#125;  </div><div class="line">  <span class="keyword">return</span> <span class="number">0</span>;  </div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>程序中调用mprotect的作用是： 修改一段指定内存区域的保护属性。以防万一，将这它改为可读写，因为后面就要对这块内存做写操作了。<br><a href="https://linux.die.net/man/2/mprotect" target="_blank" rel="external">函数原型</a>为：<code>int mprotect(const void *start, size_t len, int prot);</code><br>mprotect()函数把自start开始的、长度为len的内存区的保护属性修改为prot指定的值。<br>需要指出的是，指定的内存区间必须包含整个内存页（4K）。区间开始的地址start必须是一个内存页的起始地址，并且区间长度len必须是页大小的整数倍。</p>
<p>用法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hook_call(&quot;libjavacore.so&quot;, &quot;getaddrinfo&quot;, &amp;my_getaddrinfo);</div></pre></td></tr></table></figure></p>
<ul>
<li>1.调用dlopen拿到so的句柄,得到soinfo,它包含了符号表、重定位表、plt表等信息。</li>
<li>2.查找需要hook的函数的符号，得到它在符号表中的索引。</li>
<li>3.遍历plt表，直到匹配第2步中找到的符号索引。<br>如果是JUMP_SLOT类型（函数调用），替换为新的符号地址（函数指针）。<br>如下图所示，<code>my_code_func</code>的函数地址替换了GOT表项中原来指向libc中的<code>getaddrinfo</code>函数地址,达到了hook的效果。<br><img src="http://ww1.sinaimg.cn/large/8b331ee1gy1fknbjaa5c4j215m0q0jur.jpg" alt=""></li>
</ul>
<p>跟进一步地，可以把设备上的<code>libjavacore.so</code>导出，用IDA Pro打开，观察<code>getaddrinfo</code>的引用关系，将有助于理解上面的代码。</p>
<p>找到<code>libjavacore.so</code>中<code>getaddrinfo</code>导入符号的位置：<br><img src="http://ww1.sinaimg.cn/large/8b331ee1gy1fknbmf8o6oj20lc09o75g.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/large/8b331ee1gy1fknbmu8d3cj218i0203z9.jpg" alt=""></p>
<p>定位到<code>getaddrinfo</code>在plt表中引用的位置：<br><img src="http://ww1.sinaimg.cn/large/8b331ee1gy1fknbn5ojkjj21ga03ygn7.jpg" alt=""></p>
<p>定位到<code>getaddrinfo</code>在GOT表中引用的位置：<br><img src="http://ww1.sinaimg.cn/large/8b331ee1gy1fknbnfg0q4j215q02ota6.jpg" alt=""></p>
<p>定位到在代码段中调用<code>getaddrinfo</code>的位置：<br><img src="http://ww1.sinaimg.cn/large/8b331ee1gy1fknbnwwei1j20yy044q44.jpg" alt=""></p>
<p>通过分析得知，虽然<code>getaddrinfo</code>是<code>libc.so</code>的导出函数，但是这种方法无法hook导出函数，没有一劳永逸的方法，只能hook导入函数，因为这种方案是通过修改GOT表项实现的，这是它的缺陷。</p>
<h3 id="3、webview"><a href="#3、webview" class="headerlink" title="3、webview"></a>3、webview</h3><p>webview作为H5的容器，在做网络请求的时候也需要做DNS域名解析，要对其接入HttpDNS的一般做法是通过拦截WebView的各类网络请求，截取URL请求的host，然后调用HttpDns解析该host，通过得到的ip组成新的URL来请求网络地址。<br>不过这种方式只能处理资源，处理正常的http/https请求会存在问题。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> WebResourceResponse <span class="title">shouldInterceptRequest</span><span class="params">(WebView view, WebResourceRequest request)</span> </span>&#123; </div><div class="line">	<span class="keyword">if</span> (request.getMethod().equalsIgnoreCase(<span class="string">"get"</span>)) &#123; </div><div class="line">		String url = request.getUrl().toString(); </div><div class="line">		<span class="comment">// HttpDns解析css文件的网络请求及图片请求 </span></div><div class="line">		<span class="keyword">if</span> (url.contains(<span class="string">".css"</span>) || url.endsWith(<span class="string">".png"</span>)) &#123; </div><div class="line">		<span class="keyword">try</span> &#123; </div><div class="line">			URL oldUrl = <span class="keyword">new</span> URL(url); </div><div class="line">			URLConnection connection = oldUrl.openConnection(); </div><div class="line">			<span class="comment">// 获取HttpDns域名解析结果 </span></div><div class="line">			String ips = MSDKDnsResolver.getInstance().getAddrByName(oldUrl.getHost()); </div><div class="line">			String newUrl = url.replaceFirst(oldUrl.getHost(), ip); </div><div class="line">			<span class="comment">// 设置HTTP请求头Host域 </span></div><div class="line">			connection = (HttpURLConnection) <span class="keyword">new</span> URL(newUrl).openConnection(); </div><div class="line">			connection.setRequestProperty(<span class="string">"Host"</span>, oldUrl.getHost()); </div><div class="line">			&#125;</div><div class="line">			<span class="keyword">return</span> <span class="keyword">new</span> WebResourceResponse(<span class="string">"text/css"</span>, <span class="string">"UTF-8"</span>, connection.getInputStream()); </div><div class="line">		&#125;</div><div class="line">	&#125;&#125;</div></pre></td></tr></table></figure></p>
<p>必须要对webview的DNS域名解析函数进行拦截替换。<br>webview的DNS域名解析函数具体实现是在<code>chromiumn.so</code>，不同版本的实现也不同，5.0版本的代码见<a href="http://androidxref.com/5.0.0_r2/xref/external/chromium_org/ppapi/cpp/host_resolver.h" target="_blank" rel="external">host_resolver.h</a><br>webview的DNS域名解析函数是否也跟java的网络库一样最终调用的<code>libc.so</code>动态库中<code>getaddrinfo</code>呢？<br>通过源码注释得知确实如此。<br><img src="http://ww1.sinaimg.cn/large/8b331ee1gy1fknbo84ymdj21aa08sq77.jpg" alt=""><br><a href="http://blog.csdn.net/u012455213/article/details/54691340" target="_blank" rel="external">用Android Studio调试Framework层代码</a>中也对其进行过断点调试。<br>所以解决方法很简单，只需要hook <code>libchromium_net.so</code>中<code>getaddrinfo</code>导入符号即可。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hook_call(&quot;libchromium_net.so&quot;, &quot;getaddrinfo&quot;, &amp;my_getaddrinfo);</div></pre></td></tr></table></figure></p>
<h2 id="机型问题"><a href="#机型问题" class="headerlink" title="机型问题"></a>机型问题</h2><p>在实践中我们发现，不同机型不同版本的android在实现DNS解析函数的导出符号是不同的，更糟糕的是调用DNS解析函数的动态库也不一定就是<code>libjavacore.so</code>。<br>我之前定位过Android5.0设备的DNS解析函数，发现它的名字改为<code>android_getaddrinfofornet</code>。<br><img src="http://ww1.sinaimg.cn/large/8b331ee1gy1fknbok6ktgj213y0f20tk.jpg" alt=""><br>webview的so库位置也曾遇到过找不到的问题。</p>
<p>解决方法是通过一个脚本，pull下测试设备上的所有so到主机上，然后用readelf工具查找so的导入符号，观察是否有<code>getaddrinfo</code>字样的导入符号。<br>为此我写了一个<a href="https://github.com/FelixZhang00/so-finder" target="_blank" rel="external">脚本</a>，方便自动化进行。运行如下命令即可<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ python sofinder.py <span class="_">-e</span> getaddrinfo</div></pre></td></tr></table></figure></p>
<p><img src="http://ww1.sinaimg.cn/large/8b331ee1gy1fknbotls24j20wj0bw74u.jpg" alt=""><br>在上面输出的第一行可以看到，android 5.0以上版本webview的so已经被放在system/app目录中了。<br>需要写全so的路径：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hook_call(&quot;/system/app/WebViewGoogle/lib/arm/libwebviewchromium.so&quot;, &quot;getaddrinfo&quot;, &amp;my_getaddrinfo);</div></pre></td></tr></table></figure></p>
<hr>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://mp.weixin.qq.com/s?__biz=MzA3ODgyNzcwMw==&amp;mid=201837080&amp;idx=1&amp;sn=b2a152b84df1c7dbd294ea66037cf262&amp;scene=2&amp;from=timeline&amp;isappinstalled=0&amp;utm_source=tuicool" target="_blank" rel="external">【鹅厂网事】全局精确流量调度新思路-HttpDNS服务详解</a><br><a href="http://blog.csdn.net/u012455213/article/details/53862637" target="_blank" rel="external">ELF文件及android hook原理</a><br><a href="http://shadowwhowalks.blogspot.com/2013/01/android-hacking-hooking-system.html" target="_blank" rel="external">Andrey Petrov’s blog</a></p>

	
	
	
	
</div>
				
				

                <!-- Post Comments -->
                
                    
    <!-- 使用多说评论 -->
    <link rel="stylesheet" href="/css/duoshuo.min.css">
<style>
    #ds-thread #ds-reset .ds-post-button{
        background-color: #0097A7 !important;
    }
    #ds-wrapper #ds-reset .ds-icons-32{
        background-color: #0097A7 !important;
    }
    #ds-reset .ds-highlight {
        color: #0097A7 !important;
    }
</style>
<div id="comments">
    <!-- 多说评论框 start -->
        <div class="ds-thread" 
            data-thread-key="2017/10/19/webview接入HttpDNS实践/" 
            data-url="http://felixzhang00.github.io/2017/10/19/webview接入HttpDNS实践/"
            data-title="webview接入HttpDNS实践"></div>
    <!-- 多说评论框 end -->
</div>



                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    
    <!-- Prev Nav -->
    
        <a href="/2020/03/24/APK包大小优化总结/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2017/10/08/JVM的简单实现/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>
        </div>
    </div>

				
				
					<!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay "></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored  sidebar-fixed-left" role="navigation">
	<div id="sidebar-main">
	    <!-- Sidebar Header -->
		<div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
    <i class="material-icons">clear_all</i>
    <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.jpg" alt="Felix's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        836828946@qq.com
        <b class="caret"></b>
    </a>
</div>

		<!-- Sidebar Navigation  -->
		<ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
			
                <li>
                    <a href="#" target="_blank" title="Email Me">
						<i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    <li id="sidebar-first-li">
        <a href="/" target="_self">
            <i class="material-icons sidebar-material-icons">home</i>
             主页
        </a>
    </li>

    <!-- I'm Feeling Lucky -->
<!--
    <li class="dropdown">
        <a href="" target="_self">
            <i class="material-icons sidebar-material-icons">explore</i>
             sidebar.imlucky
        </a>
    </li>
-->

	
    <!-- Archives  -->
    <li class="dropdown">
        <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
            <i class="material-icons sidebar-material-icons">inbox</i>
             归档
            <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
            <li>
            <a class="sidebar_archives-link" href="/archives/2020/03/">三月 2020<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/10/">十月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/07/">七月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/03/">三月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/02/">二月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/01/">一月 2017<span class="sidebar_archives-count">9</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/12/">十二月 2016<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/05/">五月 2015<span class="sidebar_archives-count">7</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/04/">四月 2015<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/02/">二月 2015<span class="sidebar_archives-count">1</span></a>
        </ul>
    </li>

    <!-- Divider -->
    <li class="divider"></li>


    <!-- Pages  -->
	

    <!-- Article Numebr  -->
    <li>
        <a href="/archives">
             文章总数
             <span class="sidebar-badge">39</span>
        </a>
    </li>
</ul>

		<!-- Sidebar Divider -->
		<div class="sidebar-divider"></div>

		<!-- Sidebar Footer -->
		<!-- 
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持。 :) 
-->

<!-- Theme Material -->
<a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
	<div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
		主题 - Material
		<span class="sidebar-badge badge-circle">i</span>
	</div>
</a>

<!-- Help & Support -->
<!--
<a href="mailto:hiviosey@gmail.com" class="sidebar-footer-text-a">
    <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
		sidebar.help
		<span class="mdl-button__ripple-container">
			<span class="mdl-ripple"></span>
		</span>
	</div>
</a>
-->

<!-- Feedback -->
<!--
<a href="https://github.com/viosey/hexo-theme-material/issues" target="_blank" class="sidebar-footer-text-a">
    <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
         sidebar.feedback
                    <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
</a>
-->

<!-- Abount Theme -->
<!--
<a href="https://blog.viosey.com/index.php/Material.html" target="_blank" class="sidebar-footer-text-a">
    <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
         sidebar.about_theme
        <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
</a>-->

	</div>
    
    <!-- Sidebar Sponsor -->
    


</aside>

				
				
				
					<!-- Footer Top Button -->
					<div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>
				
				
				<!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
	
	
		<!-- Paradox Footer Left Section -->
		<div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
    <a href="https://twitter.com/twitter" target="view_window"><button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-twitter.png);">
        <span class="visuallyhidden">Twitter</span>
    </button></a>
    

    <!-- Facebook -->
    
    <a href="https://www.facebook.com/facebook" target="view_window"><button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-facebook.png);">
        <span class="visuallyhidden">Facebook</span>
    </button></a>
    

    <!-- Google + -->
    
    <a href="https://www.google.com/" target="view_window"><button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-gplus.png);">
        <span class="visuallyhidden">Google Plus</span>
    </button></a>
    

    <!-- Weibo -->
    
    

    <!-- Instagram -->
    
    

    <!-- Tumblr -->
    
    

    <!-- Github -->
    
    <a href="https://github.com/FelixZhang00" target="view_window"><button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-github.png);">
        <span class="visuallyhidden">Github</span>
    </button></a>
    

    <!-- LinkedIn -->
    
    
</div>


		<!--Copyright-->
		<div id="copyright">Copyright&nbsp;©&nbsp;<script type="text/javascript">var fd = new Date();document.write(fd.getFullYear());</script>&nbsp;FelixZhang's Blog</div>

		<!-- Paradox Footer Right Section -->

		<!-- 
		I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright.
		It will not impact the appearance and can give developers a lot of support :)

		很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
		它不会影响美观并可以给开发者很大的支持。 :) 
		-->

		<div class="mdl-mini-footer--right-section">
			<div>
				<div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
				<div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
			</div>
		</div>
	
    
</footer>
                
				<!-- Import File -->
<script src="/js/highlight.min.js"></script>
<script src="/js/js.min.js"></script>
<script src="/js/nprogress.js"></script>

<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    
    $('#nprogress .bar').css({
        'background': '#FF4081'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #FF4081, 0 0 15px #FF4081'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#FF4081',
        'border-left-color': '#FF4081'
    });
    
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>








    <!-- 多说公共 js 代码 start -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:"felixzhang00"};
        (function() {
            var ds = document.createElement('script');
            ds.type = 'text/javascript';ds.async = true;
            ds.src = 'https://static.duoshuo.com/embed.js';
            ds.charset = 'UTF-8';
            (document.getElementsByTagName('head')[0] 
             || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
    </script>
    <!-- 多说公共 js 代码 end -->




<!-- Swiftye -->


<!-- Local Search-->

	<script>
	var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        success: function( xmlResponse ) {
            // get the contents from search data
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var str='<ul class=\"search-result-list\">';                
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length <= 0) {
                    return;
                }
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        str += "<li><a href='"+ data_url +"' class='search-result-title' target='_blank'>"+ data_title;
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out characters
                            var start = first_occur - 6;
                            var end = first_occur + 6;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 10;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substr(start, end); 
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<em class=\"search-keyword\">"+keyword+"</em>");
                            })
                            str += "<p class=\"search-result\">" + match_content +"...</p>" +"</a>";
                        }
                    }
                })
                $resultContent.innerHTML = str;
            })
        }
    })
}
</script>

	<script>
        var inputArea = document.querySelector("#search");
        var getSearchFile = function(){
            var path = "search.xml";
            searchFunc(path, 'search', 'local-search-result');
        }

        inputArea.onfocus = function(){ getSearchFile() }
	</script>


<!-- Window Load-->
<script>
    $(window).load(function() {
        // Post_Toc parent position fixed
        $(".post-toc-wrap").parent(".mdl-menu__container").css("position", "fixed");
    });
</script>

<!-- MathJax Load-->

            </main>
        </div>
		
    </body>
		
	
</html>
